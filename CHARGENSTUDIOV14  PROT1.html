<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CharGen Studio PRO </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Paleta de Cores Tema Terra --- */
        :root {
            --bg-main: #2a2a24; /* Um cinza quente e escuro */
            --bg-ui-main: #292524; /* stone-800 */
            --bg-ui-secondary: #1c1917; /* stone-900 */
            --text-main: #e7e5e4; /* stone-200 */
            --text-secondary: #a8a29e; /* stone-400 */
            --border-color: #44403c; /* stone-700 */
            --accent-green: #059669; /* emerald-600 */
            --accent-green-hover: #047857; /* emerald-700 */
            --accent-green-light: #10b981; /* emerald-500 */
            --accent-warm: #f59e0b; /* amber-500 */
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-main); 
            color: var(--text-main); 
        }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-ui-main); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: var(--accent-green); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-green-hover); }
        
        .accordion-content, .main-section-content { 
            transition: max-height 0.4s ease-in-out, padding 0.4s ease-in-out, opacity 0.3s ease-in-out;
            overflow: hidden; max-height: 0; opacity: 0; padding-top: 0; padding-bottom: 0; 
        }
        .accordion-content.open, .main-section-content.open { 
            max-height: 2500px; opacity: 1; padding-top: 1rem; padding-bottom: 1rem;
        }
        
        .selected-item { background-color: var(--accent-green) !important; color: #fff !important; font-weight: 600; }

        select, input, textarea {
            background-color: #44403c; border: 1px solid #57534e; color: var(--text-main); border-radius: 0.5rem; width: 100%; padding: 0.5rem;
        }
        select:focus, input:focus, textarea:focus { 
            border-color: var(--accent-green-light); 
            box-shadow: 0 0 0 2px var(--accent-green); 
            outline: none; 
        }

        .loader {
            border: 4px solid #e5e5e5; border-top: 4px solid var(--accent-green-light); border-radius: 50%;
            width: 24px; height: 24px; animation: spin 1s linear infinite;
        }
        .small-loader { border-width: 3px; width: 18px; height: 18px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .ai-suggestion-btn {
            padding: 0.3rem; margin-left: 0.5rem; background-color: #0d9488; color: white; /* teal-600 */
            border-radius: 0.375rem; font-size: 0.75rem; line-height: 1; display: inline-flex; align-items: center;
        }
        .ai-suggestion-btn:hover { background-color: #0f766e; } /* teal-700 */
        
        .section-arrow { transition: transform 0.3s ease; }
        .active .section-arrow { transform: rotate(180deg); }

        #sidebar { transition: transform 0.3s ease-in-out; }
        #rascunhoSidebar { transition: transform 0.3s ease-in-out; z-index: 60; }
        #openRascunhoBtn { z-index: 55; transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; }
        #openRascunhoBtn.hidden { opacity: 0; visibility: hidden; }

        .tooltip { position: relative; display: inline-block; width: 100%; }
        .tooltip .tooltip-text {
            visibility: hidden; width: 220px; background-color: var(--bg-ui-main); color: #fff;
            text-align: center; border-radius: 6px; padding: 8px; position: absolute;
            z-index: 10; bottom: 125%; left: 50%; margin-left: -110px; opacity: 0;
            transition: opacity 0.3s; font-size: 0.8rem; border: 1px solid var(--border-color);
        }
        .tooltip .tooltip-text::after {
            content: ""; position: absolute; top: 100%; left: 50%;
            margin-left: -5px; border-width: 5px; border-style: solid;
            border-color: var(--bg-ui-main) transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="p-4 md:p-6">

    <!-- Botão e Sidebar de Rascunho -->
    <button id="openRascunhoBtn" class="fixed top-1/2 right-0 transform -translate-y-1/2 bg-emerald-600 hover:bg-emerald-700 text-white p-3 rounded-l-lg shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
    </button>
    <div id="rascunhoSidebar" class="fixed top-0 right-0 h-full w-full sm:w-80 md:w-96 bg-stone-800 shadow-xl transform translate-x-full p-4 flex flex-col border-l border-stone-700">
        <div class="flex justify-between items-center mb-4">
            <h3 class="font-orbitron text-lg text-emerald-300">Rascunho de Ideias</h3>
            <button id="closeRascunhoBtn" class="text-stone-300 hover:text-white p-1 rounded-md hover:bg-stone-700">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
        <textarea id="rascunhoTextarea" class="w-full flex-grow p-2 bg-stone-900 border-stone-700 rounded-md text-stone-200 text-sm mb-4 resize-none" placeholder="Digite ou gere ideias aqui..."></textarea>
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
            <button id="addRascunhoToPromptBtn" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-3 rounded-lg text-sm">Adicionar ao Prompt</button>
            <button id="clearRascunhoBtn" class="flex-1 bg-red-700 hover:bg-red-800 text-white font-semibold py-2 px-3 rounded-lg text-sm">Limpar Rascunho</button>
        </div>
    </div>

    <!-- Header Principal -->
    <header class="flex justify-between items-center mb-6 pb-4 border-b border-stone-700">
        <h1 class="font-orbitron text-2xl md:text-3xl font-bold text-emerald-400">CharGen Studio <span class="text-emerald-600">PROT1</span></h1>
        <button id="hamburger-btn" class="p-2 rounded-md hover:bg-stone-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 md:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>
        </button>
    </header>

    <div class="md:grid md:grid-cols-12 md:gap-8">
        
        <!-- Sidebar de Categorias -->
        <aside id="sidebar" class="md:col-span-4 lg:col-span-3 fixed md:relative top-0 left-0 h-full w-80 md:w-auto bg-stone-900 md:bg-transparent shadow-xl md:shadow-none transform -translate-x-full md:translate-x-0 z-40 p-4 md:p-0">
            <div class="flex justify-between items-center mb-4 pb-4 border-b border-stone-700 md:hidden">
                 <h2 class="font-orbitron text-xl text-emerald-300">Categorias</h2>
                 <button id="close-sidebar-btn" class="p-2 rounded-md hover:bg-stone-700">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                 </button>
            </div>
            <div class="h-full overflow-y-auto pr-2">
                 <form id="characterForm">
                     <div id="categories-container" class="space-y-2">
                         <!-- Categorias serão inseridas aqui via JS -->
                     </div>
                 </form>
            </div>
        </aside>

        <!-- Conteúdo Principal -->
        <main class="md:col-span-8 lg:col-span-9 space-y-4">
            
            <!-- Seção de Análise por IA (Acordeão) -->
            <div class="bg-stone-800 rounded-lg shadow-xl">
                <button class="main-section-header w-full p-4 flex justify-between items-center text-left hover:bg-stone-700/50 transition-colors rounded-lg">
                    <h2 class="font-orbitron text-xl text-emerald-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-emerald-400"><path stroke-linecap="round" stroke-linejoin="round" d="M10.05 4.575a1.575 1.575 0 1 0-3.15 0v3m3.15-3v-1.5a1.575 1.575 0 0 1 3.15 0v1.5m-3.15 0S8.505 4.5 8.25 4.5m5.625 4.5H18a2.25 2.25 0 0 1 2.25 2.25v3.75a2.25 2.25 0 0 1-2.25 2.25H13.875m0 0A2.25 2.25 0 0 1 11.625 15h-1.5a2.25 2.25 0 0 1-2.25-2.25V8.625c0-.621.504-1.125 1.125-1.125h1.5a2.25 2.25 0 0 1 2.25 2.25Z" /></svg>
                        Análise com IA
                    </h2>
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 section-arrow text-stone-400"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
                </button>
                <div class="main-section-content px-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="imageUpload" class="block text-sm font-medium text-stone-300 mb-1">Upload de Imagem (PNG, JPG, WEBP - max 4MB)</label>
                            <input type="file" id="imageUpload" accept="image/png, image/jpeg, image/webp" class="w-full text-sm text-stone-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-emerald-600 file:text-white hover:file:bg-emerald-700 cursor-pointer">
                            <div id="imagePreviewContainer" class="mt-4 w-full h-48 bg-stone-700 rounded-lg flex items-center justify-center overflow-hidden mx-auto">
                                <img id="imagePreview" src="#" alt="Pré-visualização da Imagem" class="hidden max-h-full max-w-full object-contain">
                                <span id="imagePreviewPlaceholder" class="text-stone-500">Pré-visualização</span>
                            </div>
                            <button id="analyzeImageBtn" class="mt-2 w-full bg-green-700 hover:bg-green-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors flex items-center justify-center text-sm">Analisar Imagem <div id="analyzeLoader" class="loader small-loader ml-3 hidden"></div></button>
                        </div>
                        <div>
                            <label for="analyzeTxtFileInput" class="block text-sm font-medium text-stone-300 mb-1">Upload de Texto (.txt)</label>
                            <input type="file" id="analyzeTxtFileInput" class="w-full text-sm text-stone-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-emerald-600 file:text-white hover:file:bg-emerald-700 cursor-pointer">
                             <div class="mt-4 w-full h-48 bg-stone-700 rounded-lg flex items-center justify-center overflow-hidden mx-auto p-2">
                                 <p class="text-stone-500 text-center text-sm">A IA pode analisar uma descrição textual e preencher os campos do formulário.</p>
                             </div>
                            <button id="analyzeTxtAndFillBtn" class="mt-2 w-full bg-teal-700 hover:bg-teal-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors flex items-center justify-center text-sm">Analisar Texto <div id="analyzeTxtLoader" class="loader small-loader ml-3 hidden"></div></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção do Prompt Final (Acordeão) -->
            <div class="bg-stone-800 rounded-lg shadow-xl">
                <button class="main-section-header w-full p-4 flex justify-between items-center text-left hover:bg-stone-700/50 transition-colors rounded-lg">
                    <h2 class="font-orbitron text-xl text-emerald-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-emerald-400"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125.M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>
                        Seu Prompt Final
                    </h2>
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 section-arrow text-stone-400"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
                </button>
                <div class="main-section-content px-4">
                    <textarea id="generatedPrompt" rows="8" class="w-full p-3 bg-stone-900 border-stone-700 rounded-lg text-stone-200 text-sm" placeholder="Selecione as opções na barra lateral, use a IA para gerar detalhes e clique em 'Gerar Prompt'..."></textarea>
                    <div class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3">
                        <button id="generateCompactPromptBtn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-3 rounded-lg shadow-xl transition-transform hover:scale-105 text-sm">Gerar Compacto</button>
                        <button id="generateDetailedPromptBtn" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-3 rounded-lg shadow-xl transition-transform hover:scale-105 text-sm">Gerar Detalhado</button>
                        <button id="copyPromptBtn" class="w-full bg-lime-600 hover:bg-lime-700 text-white font-semibold py-2 px-3 rounded-lg shadow-md text-sm">Copiar</button>
                        <button id="randomizeAllBtn" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-semibold py-2 px-3 rounded-lg shadow-md text-sm">Aleatorizar</button>
                        <button id="clearAllBtn" class="w-full bg-red-700 hover:bg-red-800 text-white font-semibold py-2 px-3 rounded-lg shadow-md text-sm">Limpar</button>
                    </div>
                </div>
            </div>

            <!-- Seção de Geração de Imagem (Acordeão) -->
            <div class="bg-stone-800 rounded-lg shadow-xl">
                 <button class="main-section-header w-full p-4 flex justify-between items-center text-left hover:bg-stone-700/50 transition-colors rounded-lg">
                    <h2 class="font-orbitron text-xl text-emerald-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-teal-400"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" /></svg>
                        Pré-visualização da Imagem Gerada por IA
                    </h2>
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 section-arrow text-stone-400"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
                </button>
                <div class="main-section-content px-4">
                    <div class="flex flex-col items-center">
                        <button id="generateImagePreviewBtn" class="w-full md:w-2/3 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg shadow-xl transition-transform hover:scale-105 mb-4 flex items-center justify-center">
                            Gerar Imagem do Personagem com IA
                            <div id="imageGenLoader" class="loader ml-3 hidden"></div>
                        </button>
                        <div id="generatedImageContainer" class="w-full md:w-96 h-96 bg-stone-700 rounded-lg flex items-center justify-center overflow-hidden">
                            <img id="generatedImagePreview" src="#" alt="Imagem Gerada pela IA" class="hidden max-h-full max-w-full object-contain">
                            <span id="generatedImagePlaceholder" class="text-stone-500">A imagem gerada aparecerá aqui...</span>
                        </div>
                        <p class="text-xs text-stone-400 mt-2 text-center">Utiliza o "Prompt Final" para gerar a imagem.</p>
                    </div>
                </div>
            </div>
            
            <!-- Seção de Gerenciamento (Acordeão) -->
            <div class="bg-stone-800 rounded-lg shadow-xl">
                 <button class="main-section-header w-full p-4 flex justify-between items-center text-left hover:bg-stone-700/50 transition-colors rounded-lg">
                    <h2 class="font-orbitron text-xl text-emerald-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-teal-400">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375" />
                        </svg>
                        Gerenciamento
                    </h2>
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 section-arrow text-stone-400"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" /></svg>
                </button>
                <div class="main-section-content px-4">
                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="flex flex-col space-y-2">
                            <label class="block text-sm font-medium text-stone-300 mb-1">Salvar/Carregar</label>
                            <button id="saveCharacterTxtBtn" class="w-full bg-cyan-700 hover:bg-cyan-800 text-white font-semibold py-2 px-3 rounded-lg shadow-md text-sm">Salvar (.txt)</button>
                            <button id="loadCharacterBtn" class="w-full bg-teal-700 hover:bg-teal-800 text-white font-semibold py-2 px-3 rounded-lg shadow-md text-sm">Carregar (.txt)</button>
                            <input type="file" id="loadCharacterFileInput" class="hidden" accept=".txt">
                        </div>
                         <div>
                            <label for="presets" class="block text-sm font-medium text-stone-300 mb-1">Presets</label>
                            <select id="presets" name="presets" class="w-full p-2 mb-2"></select>
                            <button id="applyPresetBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-3 rounded-lg shadow-md text-sm">Aplicar Preset</button>
                        </div>
                     </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notificação Toast -->
    <div id="toast-notification" class="fixed bottom-5 right-5 bg-emerald-600 text-white py-3 px-6 rounded-lg shadow-xl text-sm z-50 transition-all duration-300 opacity-0 transform translate-y-10"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // State variables
        let openAccordion = null;
        let openMainSection = null;
        let styleSelectedTerms = new Set();
        let toastTimeout;
        let base64ImageData = null;

        const appData = {
            formSections: {
                identidade: { 
                    title: 'Identidade', 
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-3 text-emerald-400"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" /></svg>`,
                    fields: {
                        genero: { label: "Gênero", type: "select", options: ["Não especificado", "Masculino", "Feminino", "Não-binário", "Andrógino", "Gênero-fluido", "Intersexo", "Agênero", "Dois-espíritos", "Outro"] },
                        racaEspecie: { label: "Raça/Espécie", type: "select", hasOptgroups: true, options: { "Não especificado": ["Não especificado"], "Humanas": ["Humano (Caucasiano)", "Humano (Asiático)", "Humano (Africano)", "Humano (Latino)", "Humano (Indígena)", "Humano (Miscigenado)", "Humano (Nórdico)"], "Fantasia Clássica": ["Elfo (Alto Elfo)", "Elfo (Elfo da Floresta)", 'Elfo (Elfo do Mar)', "Elfo (Elfo Negro/Drow)", "Anão (da Montanha)", "Anão (da Colina)", "Orc", "Meio-Orc", "Goblin", "Hobgoblin", "Bugbear", "Hobbit/Halfling", "Gnomo (da Floresta)", "Gnomo (das Rochas)", "Tiefling", "Aasimar", "Genasi (do Fogo, Água, Ar, Terra)", "Draconato", "Homem-Fera (Lobisomem, Minotauro, Povo-Gato, Povo-Lagarto)", "Gigante", "Troll", "Ogro", "Meio-Elfo"], "Ficção Científica": ["Ciborgue", "Androide/Sintético", "Humano Aprimorado", "Alienígena (Reptiliano)", "Alienígena (Insetoide)", "Alienígena (Humanoide)", "Alienígena (Aquático)", "Alienígena (Aviário)", "Alienígena (Energético/Não-corpóreo)", "Alienígena (Silicoide)", "Mutante", "Pós-Humano", "Clone"], "Mitológicas": ["Anjo", "Arcanjo", "Demônio", "Diabo", "Súcubo/Íncubo", "Vampiro", "Fada (Pixie, Sprite)", "Sereia/Tritão", "Centauro", "Sátiro/Fauno", "Harpia", "Górgona", "Elemental (Fogo, Água, Ar, Terra, Gelo, Raio)", "Djinn/Gênio", "Kami", "Yokai (Kitsune, Oni, Tengu)"], "Outras": ["Morto-vivo (Zumbi, Esqueleto, Liche, Fantasma, Múmia)", "Construto (Golem de Pedra, Carne, Ferro)", "Autômato (Mecanismo de Relojoaria)", "Planta Antropomórfica (Dríade, Ent)", "Povo-Cogumelo", "Slime/Amorfo", "Doppelgänger/Metamorfo"] } },
                        arquetipo: { label: "Arquétipo", type: "select", options: ["Não especificado", "O Herói", "O Mentor", "O Guardião do Umbral", "O Arauto", "O Metamorfo", "A Sombra", "O Aliado/Companheiro", "O Trapaceiro/Pícaro", "A Donzela/Donzelo em Perigo", "O Vilão", "O Anti-Herói", "A Criança Divina", "A Grande Mãe", "O Sábio Velho", "O Inocente", "O Explorador", "O Rebelde", "O Amante", "O Criador", "O Governante", "O Mago/Feiticeiro", "O Bobo da Corte"] }
                    }
                },
                aparencia: {
                    title: 'Aparência',
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-3 text-teal-400"><path stroke-linecap="round" stroke-linejoin="round" d="M9.53 16.122a3 3 0 0 0-5.78 1.128 2.25 2.25 0 0 1-2.4 2.245 4.5 4.5 0 0 0 8.4-2.245c0-.399-.078-.78-.22-1.128Zm0 0a15.998 15.998 0 0 0 3.388-1.62m-5.043-.025a15.994 15.994 0 0 1 1.622-3.39m3.421 3.415a3 3 0 0 0 5.78-1.128 2.25 2.25 0 0 1 2.4-2.245 4.5 4.5 0 0 0-8.4 2.245c0 .399.078.78.22 1.128Zm0 0l3.388 1.62m-5.043-.025a15.994 15.994 0 0 1-1.622-3.39m3.421 3.415Z" /></svg>`,
                    fields: {
                        nomePersonagem: { label: "Nome", type: "text-ia", buttonId: "generateNameBtn", loaderId: "nameLoader" },
                        tipoCorpo: { label: "Tipo de Corpo", type: "select", options: ["Não especificado", "Esguio", "Atlético", "Musculoso(a)", "Corpulento(a)", "Magro(a)", "Ossudo(a)", "Curvilíneo(a)", "Plus-size", "Pequeno(a)/Baixo(a)", "Alto(a)/Gigante", "Robusto(a)", "Andrógino", "Delicado(a)", "Frágil", "Infantil", "Idoso(a)/Envelhecido", "Cicatrizado", "Deformado"] },
                        penteado: { label: "Penteado", type: "select", hasOptgroups: true, options: { "Não especificado": ["Não especificado"], "Comprimentos": ["Careca", "Muito Curto (Raspado/Buzzcut)", "Curto", "Médio (altura dos ombros)", "Longo", "Muito Longo (cintura ou mais)"], "Estilos": ["Liso", "Ondulado", "Cacheado", "Crespo/Afro", "Tranças (Boxeadoras, Nagô, etc.)", "Dreadlocks", "Rabo de Cavalo (Alto, Baixo)", "Coque (Alto, Despojado)", "Topete", "Moicano", "Undercut", "Sidecut", "Assimétrico", "Repicado", "Bagunçado/Despojado", "Alinhado/Geométrico", "Com Franja (Reta, Lateral, Cortina)"], "Cores Exóticas": ["Platinado", "Azul Elétrico", "Verde Neon", "Rosa Choque", "Multicolorido/Arco-íris"] } },
                        corPele: { label: "Cor da Pele", type: "text", placeholder: "Ex: pálida, bronzeada, azulada..." },
                        corCabelo: { label: "Cor do Cabelo", type: "text", placeholder: "Ex: loiro platinado, ruivo fogo..." },
                        corOlhos: { label: "Cor dos Olhos", type: "text", placeholder: "Ex: verde esmeralda, âmbar..." }
                    }
                },
                trajes: {
                    title: 'Trajes e Equipamentos',
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-3 text-amber-400"><path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.664 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.631 5.631L21.25 9.5l-5.208-5.209L9.5 11.042l5.63 5.63Z" /></svg>`,
                    fields: {
                        vestimentaPrincipal: { label: "Vestimenta Principal", type: "select", options: ["Não especificado", "Roupas Casuais Modernas", "Roupas de Grife", "Traje Formal (Gala, Terno)", "Uniforme (Escolar, Militar, Profissional)", "Roupas de Aventura/Explorador", "Roupas de Camponês/Plebeu", "Vestes Nobres/Reais", "Vestes Mágicas/de Feiticeiro", "Hábito Religioso/de Monge", "Traje Futurista/Sci-Fi", "Traje Pós-Apocalíptico", "Roupas Tribais/Primitivas", "Kimono/Yukata", "Qipao/Cheongsam", "Sari", "Toga", "Roupas de Couro/Punk"] },
                        armadura: { label: "Armadura", type: "select", hasOptgroups: true, options: { "Não especificado": ["Não especificado", "Sem Armadura"], "Leve": ["Couro Batido", "Corselete de Couro", "Gambeson/Acolchoada", "Armadura de Seda"], "Média": ["Cota de Malha", "Brigandina", "Loriga segmentata", "Peitoral de Aço", "Escamas de Dragão"], "Pesada": ["Armadura de Placas Completa", "Armadura de Campo Gótica", "Armadura Samurai (O-Yoroi)"], "Ficção Científica": ["Traje de Combate Leve (Kevlar)", "Armadura de Polímero", "Exoesqueleto Leve", "Power Armor", "Armadura de Energia"], "Exótica": ["Armadura de Osso", "Armadura de Quitina", "Armadura de Cristal", "Armadura Viva/Simbionte"] } },
                        armas: { label: "Arma", type: "select", hasOptgroups: true, options: { "Não especificado": ["Não especificado", "Desarmado(a)"], "Lâminas": ["Espada Longa", "Espada Curta", "Adaga/Faca", "Katana", "Wakizashi", "Cimitarra", "Rapieira", "Gládio", "Montante/Zweihänder", "Sabre de Luz"], "Machados": ["Machado de Batalha", "Machadinha", "Machado de Duas Mãos"], "Impacto": ["Maça", "Mangual", "Martelo de Guerra", "Clava", "Bastão (Bo Staff)"], "Haste": ["Lança", "Alabarda", "Glaive", "Tridente", "Pique"], "Distância (Arco/Besta)": ["Arco Curto", "Arco Longo", "Besta Leve", "Besta Pesada", "Arco Composto"], "Distância (Fogo/Pólvora)": ["Pistola Flintlock", "Mosquete", "Revólver", "Rifle"], "Distância (Moderno/Sci-Fi)": ["Pistola Semiautomática", "Submetralhadora", "Fuzil de Assalto", "Rifle de Precisão", "Lança-granadas", "Pistola Laser", "Rifle de Plasma", "Canhão de Partículas"], "Exóticas": ["Chicote", "Nunchaku", "Kusarigama", "Manoplas com Lâminas", "Shuriken/Kunai", "Bumerangue de Batalha", "Grimório/Tomo Mágico"] } }
                    }
                },
                 narrativa: {
                    title: 'Narrativa',
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-3 text-orange-400"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>`,
                    fields: {
                        temaGeral: { label: "Tema Geral", type: "select", options: ["Não especificado", "Aventura", "Batalha Épica", "Combate Singular", "Exploração", "Descoberta", "Mistério", "Investigação", "Sobrevivência", "Terror", "Romance", "Tragédia", "Comédia", "Celebração/Festa", "Ritual Mágico", "Coroação", "Fuga"] },
                        cenarioDetalhado: { label: "Cenário Detalhado", type: "select", hasOptgroups: true, options: { "Não especificado": ["Não especificado"], "Natureza": ["Floresta Densa e Antiga", "Pântano Assombrado", "Montanhas Nevadas", "Pico de Vulcão", "Deserto Árido", "Oásis Exuberante", "Selva Tropical", "Caverna de Cristais", "Recife de Coral Subaquático", "Campo de Flores Selvagens"], "Urbano": ["Castelo Medieval em Ruínas", "Cidade Futurista Distópica", "Metrópole Cyberpunk Iluminada por Néon", "Mercado Medieval Movimentado", "Viela Sombria e Chuvosa", "Salão do Trono Opulento", "Biblioteca Antiga e Poeirenta"], "Exótico/Fantástico": ["Cidade Flutuante nos Céus", "Reino Subterrâneo dos Anões", "Palácio de Gelo", "Dimensão Alienígena Bizarra", "Campo de Batalha Astral", "Interior de uma Nave Espacial", "Ruínas de uma Civilização Antiga"] } },
                        acaoPose: { label: "Ação/Pose", type: "select", hasOptgroups: true, options: { "Não especificado": ["Não especificado", "Pose Neutra/Retrato"], "Estáticas": ["Sentado(a) em um trono", "Meditando", "Lendo um livro antigo", "Observando o horizonte", "Apoiado(a) em uma parede", "De joelhos, em súplica ou prece", "Oferecendo um objeto"], "Dinâmicas": ["Correndo desesperadamente", "Saltando sobre um abismo", "Brandindo uma arma", "Lançando um feitiço", "Esquivando de um ataque", "Escalando uma montanha", "Dançando", "Sussurrando um segredo", "Pilotando um veículo"] } },
                        expressaoFacial: { label: "Expressão Facial", type: "select", options: ["Não especificado", "Neutra", "Sorrindo (Sutil, Largo)", "Gargalhando", "Triste", "Chorando", "Irritado(a)", "Enfurecido(a)", "Surpreso(a)", "Chocado(a)", "Assustado(a)", "Curioso(a)", "Desconfiado(a)", "Confiante/Arrogante", "Cansado(a)/Exausto(a)", "Sereno/Pacífico", "Concentrado(a)"] }
                    }
                },
                 desenvolvimento: {
                    title: 'Desenvolvimento',
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-lime-400"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5" /></svg>`,
                    fields: {
                        caracteristicasFisicas: { label: "Características Essenciais (Detalhes)", type: "textarea", rows: 3, placeholder: "Ex: tatuagens místicas, cicatriz no olho esquerdo..." },
                        historiaFundoGerada: { label: "História de Fundo", type: "textarea-ia", rows: 5, placeholder: "Clique para gerar uma história...", buttonId: "generateBackstoryBtn", loaderId: "backstoryLoader" },
                        promptNegativo: { label: "Prompt Negativo (Evitar)", type: "text", placeholder: "deformado, texto, watermark..." }
                    }
                }
            },
            styleLists: {
                artists: { title: "Artistas", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 mr-3 text-emerald-400"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/><path d="M15.23 5.23L9.17 10.17c-.4.39-.4 1.02 0 1.41l5.3 5.3c.39.39 1.02.39 1.41 0l.71-.71c.39-.39.39-1.02 0-1.41L11.7 10.88l4.24-4.24c.39-.39.39-1.02 0-1.41l-.71-.71c-.39-.4-.08-1.03.31-1.42z"/></svg>`, items: ['Abigail Larson (arte gótica, contos de fadas sombrios)', 'Adam Hughes (pin-ups, quadrinhos)', 'Afarin Sajedi (retratos surreais e melancólicos)', 'Akira Toriyama (Dragon Ball, Dr. Slump)', 'Alphonse Mucha (Art Nouveau, cartazes ornamentados)', 'Alvaro Siza (arquitetura minimalista)', 'Anato Finnstark (fantasia sombria, ambientes épicos)', 'Andrea Kowch (realismo mágico, narrativas rurais)', 'Andreas Rocha (paisagens de fantasia, arte de games)', 'Andrei Tarkovsky (cinema poético, Stalker)', 'Andrew Wyeth (realismo, paisagens americanas)', 'Anna Bocek (retratos expressivos, abstratos)', 'Anthony Van Dyck (retratos barrocos, nobreza)', 'Antoine Blanchard (cenas urbanas parisienses, Belle Époque)', 'Anton Fadeev (arte conceitual, ficção científica)', 'Arcimboldo (retratos com frutas e vegetais)', 'Ayami Kojima (arte de Castlevania, estilo gótico)', 'Banksy (arte de rua, crítica social)', 'Bernie Wrightson (terror, quadrinhos, Frankenstein)', 'Bill Sienkiewicz (arte de quadrinhos experimental)', 'Bob Eggleton (ficção científica, fantasia, monstros)', 'Carne Griffiths (desenhos com tinta e chá)', 'Caspar David Friedrich (Romantismo, paisagens sublimes)', 'Charlie Bowater (arte de fantasia, retratos femininos)', 'Chris Rahn (arte para Magic: The Gathering)', 'Claude Monet (Impressionismo, nenúfares)', 'Craig Mullins (pintura digital, arte conceitual)', 'Dan Mumford (pôsteres de cultura pop, cores vibrantes)', 'Dave McKean (colagens, quadrinhos, Sandman)', 'David Hockney (Pop Art, piscinas)', 'Diego Rivera (muralismo mexicano)', 'Donato Giancola (fantasia clássica, realismo)', 'Doré (ilustrações bíblicas e literárias)', 'Drew Struzan (pôsteres de filmes icônicos)', 'Ed Binkley (fantasia, personagens caprichosos)', 'Edward Gorey (ilustrações macabras e bem-humoradas)', 'Edward Hopper (solidão urbana, realismo americano)', 'Egon Schiele (Expressionismo, retratos contorcidos)', 'Eiichiro Oda (One Piece)', 'Frank Frazetta (fantasia heroica, barbáros)', 'Frida Kahlo (auto-retratos, surrealismo mexicano)', 'Gediminas Pranckevicius (paisagens surreais e sonhadoras)', 'Genndy Tartakovsky (animação, Samurai Jack)', 'Georges Seurat (Pontilhismo)', 'Georgia O\'Keeffe (flores, paisagens do Novo México)', 'Gerald Brom (fantasia gótica, arte sombria)', 'Greg Hildebrandt (pôsteres de Star Wars, fantasia)', 'Greg Rutkowski (fantasia épica, Dungeons & Dragons)', 'Guido Borelli (paisagens italianas, impressionismo)', 'Gustav Klimt (Simbolismo, O Beijo)', 'Gustave Moreau (Simbolismo, temas mitológicos)', 'H.R. Giger (arte biomecânica, Alien)', 'Hayao Miyazaki (Studio Ghibli, A Viagem de Chihiro)', 'Henri Matisse (Fauvismo, uso radical da cor)', 'Hieronymus Bosch (renascimento nórdico, cenas fantásticas)', 'Hsiao-Ron Cheng (retratos surreais e delicados)', 'Ivan Aivazovsky (paisagens marinhas, Romantismo)', 'J.C. Leyendecker (ilustração da Era de Ouro)', 'J.M.W. Turner (paisagens românticas, luz e atmosfera)', 'Jack Kirby (quadrinhos, O Rei dos Quadrinhos)', 'James Gurney (Dinotopia, realismo fantástico)', 'James Jean (arte surreal e detalhada)', 'Jason Edmiston (pôsteres de cultura pop, realismo)', 'Jean-Auguste-Dominique Ingres (Neoclassicismo, retratos)', 'Jean-Michel Basquiat (neo-expressionismo, arte de rua)', 'Jesper Ejsing (fantasia, arte para D&D e Magic)', 'Jim Burns (ficção científica, capas de livros)', 'Joan Miró (surrealismo abstrato)', 'John Avon (paisagens para Magic: The Gathering)', 'John Berkey (arte espacial, ficção científica)', 'John Harris (paisagens de ficção científica épicas)', 'John Singer Sargent (retratos realistas e elegantes)', 'John William Waterhouse (Pré-Rafaelita, mitologia)', 'Jordan Grimmer (paisagens de fantasia vibrantes)', 'Josan Gonzalez (cyberpunk, arte detalhada)', 'Josephine Wall (fantasia, seres místicos)', 'Katsuhiro Otomo (Akira, cyberpunk)', 'Kay Nielsen (ilustrações de contos de fadas)', 'Keith Haring (Pop Art, grafite)', 'Kelly Freas (ilustração de ficção científica clássica)', 'Kentaro Miura (Berserk, fantasia sombria)', 'Kiliana ENG (retratos de fantasia etéreos)', 'Kim Jung Gi (desenho dinâmico, perspectiva complexa)', 'Larry Elmore (arte de Dungeons & Dragons clássica)', 'Leonardo da Vinci (Renascimento, Mona Lisa)', 'Lois van Baarle (Loish, retratos digitais estilizados)', 'Magali Villeneuve (arte para Magic e Game of Thrones)', 'Makoto Shinkai (anime, paisagens hiper-realistas)', 'Marc Simonetti (arte de fantasia, A Roda do Tempo)', 'Mark Ryden (surrealismo pop, temas kitsch)', 'Mary Blair (arte conceitual da Disney, cores vibrantes)', 'Max Ernst (Surrealismo, Dadaísmo)', 'Maxfield Parrish (cores saturadas, Neoclassicismo)', 'Michael Whelan (capas de ficção científica e fantasia)', 'Michelangelo (Renascimento, Capela Sistina)', 'Mike Mignola (Hellboy, estilo de alto contraste)', 'Moebius (Jean Giraud) (ficção científica, quadrinhos europeus)', 'Naoko Takeuchi (Sailor Moon)', 'Norman Rockwell (realismo americano, cenas cotidianas)', 'Pablo Picasso (Cubismo)', 'Paul Cézanne (Pós-Impressionismo)', 'Peter Andrew Jones (capas de ficção científica retrô)', 'Peter Mohrbacher (anjos, Angelarium)', 'Pierre-Auguste Renoir (Impressionismo, retratos)', 'Pieter Bruegel, o Velho (Renascimento, cenas de camponeses)', 'Pino Daeni (pintura figurativa, mulheres)', 'Ralph McQuarrie (arte conceitual de Star Wars)', 'Raphael (Renascimento, A Escola de Atenas)', 'Rebecca Guay (fantasia, aquarela)', 'Rembrandt (Barroco, claro-escuro)', 'René Magritte (Surrealismo, O Filho do Homem)', 'Richard Corben (quadrinhos de terror e underground)', 'Rob Liefeld (quadrinhos dos anos 90, anatomia exagerada)', 'Robert McGinnis (pôsteres de James Bond, pulp)', 'Roger Dean (capas de álbuns de rock progressivo)', 'Roy Lichtenstein (Pop Art, pontos Ben-Day)', 'Rumiko Takahashi (InuYasha, Ranma ½)', 'Salvador Dalí (Surrealismo, A Persistência da Memória)', 'Samdoesarts (retratos digitais estilizados)', 'Seb McKinnon (arte sombria para Magic)', 'Shaun Tan (livros ilustrados surreais)', 'Syd Mead (designer futurista, Blade Runner)', 'Tamara de Lempicka (Art Déco, retratos)', 'Tarsila do Amaral (Modernismo brasileiro, Abaporu)', 'Ted Nasmith (ilustrações de Tolkien)', 'Terese Nielsen (arte para Magic: The Gathering)', 'Thomas Cole (Escola do Rio Hudson, paisagens)', 'Thomas Kinkade (pintor da luz, comercial)', 'Tim Burton (estilo gótico e excêntrico)', 'Tim Hildebrandt (fantasia, com seu irmão Greg)', 'Todd McFarlane (Spawn, quadrinhos)', 'Vincent Di Fate (ficção científica, naves espaciais)', 'Vincent van Gogh (Pós-Impressionismo, Noite Estrelada)', 'Wassily Kandinsky (abstracionismo)', 'Wayne Barlowe (criaturas alienígenas, demônios)', 'Wes Anderson (cinema simétrico e estilizado)', 'William Blake (Romantismo, mitologia pessoal)', 'William-Adolphe Bouguereau (Academicismo, realismo)', 'Yoshitaka Amano (Final Fantasy, arte etérea)', 'Yusuke Murata (One-Punch Man, arte dinâmica)', 'Zaha Hadid (arquitetura desconstrutivista)', 'Zdzisław Beksiński (distopia surrealista, arte sombria)'] },
                media: { title: "Mídia/Técnica", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 mr-3 text-teal-400"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path></svg>`, items: ['aerógrafo', 'água-forte', 'amigurumi', 'arte com areia', 'arte com pontos', 'arte com spray', 'arte com arame', 'arte de fiação', 'arte digital', 'arte em tecido', 'arte em fractal', 'arte em vidro', 'arte processual', 'arte vetorial', 'arte voxel', 'aquarela', 'assemblage', 'batik', 'bordado', 'bronze', 'capa de álbum', 'carvão', 'caseína', 'cianotipia', 'cinzeladura', 'colagem', 'colotipia', 'conceito de arte', 'crochê', 'daguerreótipo', 'decalcomania', 'desenho anatômico', 'desenho com caneta e nanquim', 'desenho com giz', 'desenho com grafite', 'desenho com lápis de cor', 'desenho com marcador', 'diorama', 'doodle', 'eletrofotografia', 'entalhe em madeira', 'escultura', 'escultura em gelo', 'esboço', 'esfuminho', 'esgrafito', 'estampa', 'estêncil', 'feltro', 'ferrotipia', 'fotobashing', 'fotograma', 'fotogravura', 'fresco', 'fumage', 'gesso', 'giz pastel', 'glitter', 'gouache', 'grafite', 'grattage', 'hachura', 'henna', 'holografia', 'ilustração', 'impressão em bloco', 'impressão giclée', 'impasto', 'kirigami', 'laca', 'lápis de cera', 'linoleogravura', 'litografia', 'low-poly', 'macramê', 'mandala', 'maquete', 'marchetaria', 'meio-tom', 'metalurgia', 'miniatura', 'monotipia', 'mosaico', 'mural', 'objeto encontrado', 'óleo sobre tela', 'origami', 'ouro', 'palekh', 'papel machê', 'papel picado', 'pastel', 'pintura acrílica', 'pintura a seco', 'pintura de areia', 'pintura em miniatura', 'pintura em seda', 'pintura em têmpera', 'pintura hard-edge', 'pirografia', 'pixel art', 'polaroid', 'ponto cruz', 'porcelana', 'pôster', 'quilling', 'rabisco', 'relevo', 'resina', 'retícula', 'serigrafia', 'stop-motion', 'tapeçaria', 'tatuagem', 'terra cota', 'tricô', 'veludo', 'vidro soprado', 'vitral', 'xilogravura'] },
                games: { title: "Jogos", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 mr-3 text-red-500"><path d="M2 12h3m14 0h3M12 2v3m0 14v3"></path><circle cx="12" cy="12" r="7"></circle></svg>`, items: ['Alan Wake', 'Animal Crossing', 'Apex Legends', 'Arkham Knight', 'Assassin\'s Creed', 'Baldur\'s Gate', 'Bastion', 'Bayonetta', 'BioShock', 'Bloodborne', 'Borderlands', 'Braid', 'Breath of the Wild', 'Castlevania', 'Chrono Trigger', 'Control', 'Cuphead', 'Cyberpunk 2077', 'Dark Souls', 'Darksiders', 'Dead Space', 'Death Stranding', 'Destiny', 'Deus Ex', 'Devil May Cry', 'Diablo', 'Disco Elysium', 'Dishonored', 'Donkey Kong', 'Doom', 'Dragon Age', 'Dragon Quest', 'Dwarf Fortress', 'Earthbound', 'Elden Ring', 'Elite Dangerous', 'Eve Online', 'Fable', 'Fallout', 'Final Fantasy', 'Final Fantasy Tactics', 'Fire Emblem', 'Fortnite', 'Gears of War', 'Ghost of Tsushima', 'God of War', 'Grand Theft Auto', 'Gris', 'Hades', 'Half-Life', 'Halo', 'Harvest Moon', 'Hellblade', 'Hollow Knight', 'Horizon Zero Dawn', 'Journey', 'Katamari Damacy', 'Kerbal Space Program', 'Kingdom Hearts', 'League of Legends', 'Left 4 Dead', 'Limbo', 'Magic the Gathering', 'Mario Kart', 'Mass Effect', 'Mega Man', 'Metal Gear Solid', 'Metroid', 'Minecraft', 'Monkey Island', 'Monster Hunter', 'Mortal Kombat', 'Nier: Automata', 'No Man\'s Sky', 'Octopath Traveler', 'Oddworld', 'Okami', 'Ori and the Blind Forest', 'Overwatch', 'Pac-Man', 'Paper Mario', 'Persona', 'Pokémon', 'Portal', 'Psychonauts', 'Ratchet & Clank', 'Red Dead Redemption', 'Resident Evil', 'Rimworld', 'Sea of Thieves', 'Sekiro', 'Shadow of the Colossus', 'Silent Hill', 'SimCity', 'Skyrim', 'Slay the Spire', 'Sonic the Hedgehog', 'Soul Calibur', 'Spelunky', 'Splatoon', 'StarCraft', 'Stardew Valley', 'Street Fighter', 'Super Mario', 'Super Metroid', 'Team Fortress', 'Tetris', 'The Last of Us', 'The Legend of Zelda', 'The Sims', 'The Witcher', 'Tomb Raider', 'Transistor', 'Undertale', 'Uncharted', 'Valorant', 'Warframe', 'World of Warcraft', 'Xenoblade', 'Yakuza'] },
                formats: { title: "Formatos", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 mr-3 text-lime-400"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>`, items: ['adesivo', 'anúncio', 'avatar', 'banner', 'blueprint', 'brochura', 'caixa de cereal', 'capa de livro', 'cartão de visita', 'cartão de tarô', 'cartão postal', 'cartaz de procurado', 'carteira de motorista', 'certidão de nascimento', 'certidão de óbito', 'colorir', 'convite', 'corte transversal', 'desenho técnico', 'diagrama explodido', 'diário de campo', 'diorama', 'documentário', 'emoji', 'emoticon', 'enciclopédia', 'esboço de moda', 'esquema', 'etiqueta', 'ficha de personagem', 'filme noir', 'fita de filme', 'foto da cena do crime', 'foto de vigilância', 'fotografia de moda', 'grafite', 'hieróglifos', 'história em quadrinhos', 'ilustração botânica', 'infográfico', 'jornal', 'livro de receitas', 'livro pop-up', 'logotipo', 'manual de instruções', 'manuscrito iluminado', 'mapa do tesouro', 'modelo 3D', 'nota de dinheiro', 'panfleto', 'passaporte', 'patente', 'pôster de filme', 'propaganda', 'relatório de autópsia', 'revista', 'selo postal', 'sinalização', 'site', 'storyboard', 'tatuagem', 'telegrama', 'toy art', 'videoclipe'] },
                aesthetics: { title: "Estética", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 mr-3 text-amber-400"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>`, items: ['Academia Sombria (Dark Academia)', 'Afrofuturismo', 'Anacronismo', 'Anime (anos 80, 90)', 'Art Déco', 'Art Nouveau', 'Atompunk', 'Barroco', 'Bauhaus', 'Biopunk', 'Brutalismo', 'Ciber-gótico', 'Ciber-noir', 'Ciber-prep', 'Ciberdelia', 'Cyberpunk (neon, distopia futurista)', 'Decopunk', 'Dieselpunk', 'Distopia', 'Emo', 'Espacial', 'Etéreo', 'Fantasia Sombria (Dark Fantasy)', 'Fauvismo', 'Film Noir', 'Fofo (Kawaii)', 'Fotorrealismo', 'Frutiger Aero (interface de 2000)', 'Futurismo', 'Gótico', 'Grunge', 'High-tech (alta tecnologia)', 'Hip-hop (anos 90)', 'Hope-punk (otimismo)', 'Industrial', 'Infantil', 'Kitsch', 'Lofi', 'Lolita (Gótica, Doce)', 'Lunarpunk', 'Maximalismo', 'Medieval', 'Memphis (design anos 80)', 'Militar', 'Minimalismo', 'Modernismo de Meados do Século', 'Mori Kei (garota da floresta)', 'Náutico', 'Neon', 'Noir', 'Nostálgico', 'Op-Art (arte óptica)', 'Pastel', 'Pós-apocalíptico', 'Pré-histórico', 'Psicodélico', 'Punk', 'Raygun Gothic (retrô sci-fi)', 'Retrofuturismo', 'Retrowave', 'Rococó', 'Romantismo', 'Rústico', 'Sci-fi (ficção científica)', 'Seapunk', 'Skeumorfismo', 'Solarpunk (eco-futurismo)', 'Steampunk (vapor e engrenagens)', 'Surrealismo', 'Synthwave', 'Techwear (roupas técnicas)', 'Tribal', 'Tropical', 'Ukiyo-e (arte japonesa)', 'Vaporwave', 'Vitoriano', 'VSCO', 'Western (faroeste)', 'Witchcore (estética de bruxa)', 'Y2K (anos 2000)', 'Zombiecore'] },
                acessorios: { title: "Acessórios & Itens", icon: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5 mr-3 text-cyan-400"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.658-.463 1.243-1.119 1.243H5.502c-.656 0-1.19-.585-1.12-1.243l1.263-12a1.125 1.125 0 0 1 1.12-1.007h8.475a1.125 1.125 0 0 1 1.12 1.007Z" /></svg>`, items: ["Amuleto/Talismã", "Anel Mágico", "Bandoleira", "Bolsa de Cinto", "Brincos", "Bússola/Astroábio", "Cajado", "Cantil", "Capa/Manto com Capuz", "Chapéu/Elmo", "Coroa/Tiara", "Ferramentas de Ladrão", "Kit de Alquimia", "Luvas/Manoplas", "Mapa/Pergaminho", "Máscara", "Mochila", "Óculos/Monóculo", "Orbe de Cristal", "Piercings", "Varinha Mágica", "Visor Tecnológico"] },
                periods: { title: "Períodos Históricos", icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 mr-3 text-orange-400"><path d="M5 22h14"></path><path d="M5 2h14"></path><path d="M12 2v2.34a6 6 0 0 1 0 11.32V22"></path><path d="M12 22v-2.34a6 6 0 0 0 0-11.32V2"></path></svg>`, items: ['Anos 1920 (Loucos Anos Vinte)', 'Anos 1950', 'Anos 1960 (Era Espacial)', 'Anos 1970 (Era Disco)', 'Anos 1980', 'Anos 1990', 'Anos 2000 (Y2K)', 'Antigo Egito', 'Antiga China', 'Antiga Grécia', 'Antiga Roma', 'Belle Époque', 'Brasil Colônia', 'Corrida do Ouro', 'Era de Ouro da Pirataria', 'Era do Jazz', 'Era Elizabetana', 'Era Regencial', 'Era Vitoriana', 'Faroeste Americano', 'Guerra Civil Americana', 'Guerra Fria', 'Guerra do Vietnã', 'Idade da Pedra', 'Idade do Bronze', 'Idade do Ferro', 'Idade Média', 'Iluminismo', 'Império Asteca', 'Império Bizantino', 'Império Inca', 'Império Mongol', 'Império Otomano', 'Império Persa', 'Império Romano', 'Japão Feudal (Período Edo)', 'Japão Meiji', 'Pré-colombiano', 'Primeira Guerra Mundial', 'Proibição (Lei Seca)', 'Renascimento', 'Revolução Francesa', 'Revolução Industrial', 'Revolução Russa', 'Segunda Guerra Mundial'] }
            }
        };

        const presets = {
            "guerreiraOrc": { nomePersonagem: "Grakka, a Esmagadora", racaEspecie: "Fantasia Clássica|Orc", genero: "Feminino", arquetipo: "O Herói", tipoCorpo: "Musculoso(a)", corPele: "Verde-acinzentado", penteado: "Comprimentos|Longo", vestimentaPrincipal: "Roupas de Aventura", armadura: "Pesada|Armadura de Placas Completa", armas: "Lâminas|Machado de Batalha", temaGeral: "Batalha", acaoPose: "Dinâmicas|Brandindo arma", expressaoFacial: "Irritado(a)", styleSelectedTerms: ["Frank Frazetta (fantasia heroica, barbáros)", "Fantasia Sombria (Dark Fantasy)"]},
            "magaElfa": { nomePersonagem: "Lyra Noctu", racaEspecie: "Fantasia Clássica|Elfo (Elfo Negro/Drow)", genero: "Feminino", arquetipo: "O Mentor", tipoCorpo: "Esguio", corPele: "Cinza obsidiana", corCabelo: "Branco platinado", penteado: "Comprimentos|Muito Longo (cintura ou mais)", vestimentaPrincipal: "Vestes Mágicas/de Feiticeiro", armas: "Exóticas|Grimório/Tomo Mágico", temaGeral: "Mistério", cenarioDetalhado: "Natureza|Caverna de Cristais", acaoPose: "Dinâmicas|Lançando um feitiço", expressaoFacial: "Concentrado(a)", styleSelectedTerms: ["Yoshitaka Amano (Final Fantasy, arte etérea)", "Gótico", "Luz Volumétrica/Raios de Luz"]},
            "ciborgueHacker": { nomePersonagem: "Zero", racaEspecie: "Ficção Científica|Ciborgue", genero: "Não-binário", arquetipo: "O Trapaceiro/Pícaro", tipoCorpo: "Atlético", vestimentaPrincipal: "Traje Futurista/Sci-Fi", armadura: "Ficção Científica|Exoesqueleto Leve", armas: "Distância (Moderno/Sci-Fi)|Pistola Laser", temaGeral: "Aventura", cenarioDetalhado: "Urbano|Metrópole Cyberpunk Iluminada por Néon", acaoPose: "Estáticas|Observando o horizonte", expressaoFacial: "Confiante/Arrogante", styleSelectedTerms: ["Syd Mead (designer futurista, Blade Runner)", "Cyberpunk (neon, distopia futurista)", "Lens Flare"] }
        };


        // --- CORE FUNCTIONS ---

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast-notification');
            if(!toast) return;
            toast.textContent = message;
            
            toast.className = 'fixed bottom-5 right-5 text-white py-3 px-6 rounded-lg shadow-xl text-sm z-50 transition-all duration-300 opacity-0 transform translate-y-10';
            
            requestAnimationFrame(() => {
                toast.classList.remove('opacity-0', 'translate-y-10');
                switch (type) {
                    case 'success': toast.classList.add('bg-lime-600'); break;
                    case 'error': toast.classList.add('bg-red-700'); break;
                    case 'warning': toast.classList.add('bg-amber-500'); break;
                    default: toast.classList.add('bg-emerald-600'); break;
                }
            });

            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
            }, 3000);
        }

        function copyUsingExecCommand(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                if (document.execCommand('copy')) {
                    showToast('Copiado para a área de transferência!', 'success');
                } else {
                    showToast('Falha ao copiar.', 'error');
                }
            } catch (err) {
                showToast('Erro ao copiar.', 'error');
            }
            document.body.removeChild(textArea);
        }
        
        // --- API CALL FUNCTIONS (Actual Implementation) ---

        async function callApi(apiUrl, payload, loaderElement, buttonElement) {
            if (loaderElement) loaderElement.classList.remove('hidden');
            if (buttonElement) {
                buttonElement.disabled = true;
                buttonElement.classList.add('opacity-50', 'cursor-not-allowed');
            }
            
            const apiKey = "";
            const finalApiUrl = `${apiUrl}?key=${apiKey}`;

            try {
                const response = await fetch(finalApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    const errorMessage = errorData?.error?.message || 'Erro desconhecido na API.';
                    console.error('API Error:', response.status, errorMessage, errorData);
                    throw new Error(`Erro ${response.status}: ${errorMessage}`);
                }
                
                return await response.json();

            } catch (error) {
                console.error('Fetch Error:', error);
                showToast(`Erro na comunicação com a IA: ${error.message}`, 'error');
                return null;
            } finally {
                if (loaderElement) loaderElement.classList.add('hidden');
                if (buttonElement) {
                    buttonElement.disabled = false;
                    buttonElement.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }
        }


        // --- UI & FORM RENDERING FUNCTIONS ---

        function createAccordionButton(key, title, icon) {
            return `<div class="category-wrapper">
                        <button data-key="${key}" class="category-button w-full flex items-center justify-start p-3 bg-stone-800 rounded-lg shadow-md hover:bg-stone-700/50 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all duration-200 h-full">
                            ${icon} <span class="ml-3 text-sm font-semibold text-stone-300">${title}</span>
                        </button>
                        <div id="accordion-${key}" class="accordion-content bg-stone-800/50 rounded-b-lg px-4 -mt-1">
                        </div>
                    </div>`;
        }
        
        function createStyleAccordionContent(key, targetElement) {
            let itemsHTML = '';
            const sortedItems = [...appData.styleLists[key].items].sort((a, b) => a.localeCompare(b, undefined, { sensitivity: 'base' }));

            sortedItems.forEach(itemText => {
                let term = itemText;
                let description = '';
                const match = itemText.match(/(.*?)\s*\(([^)]+)\)/);
                
                if (match) {
                    term = match[1].trim();
                    description = match[2].trim();
                }

                const isSelected = styleSelectedTerms.has(term) ? 'selected-item' : '';
                itemsHTML += `
                    <div class="tooltip w-full">
                        <a href="#" class="style-term-item block w-full px-3 py-1.5 text-sm text-stone-200 hover:bg-emerald-500/50 rounded-md ${isSelected}" data-term="${term}">
                            ${term}
                        </a>
                        ${description ? `<span class="tooltip-text">${description}</span>` : ''}
                    </div>`;
            });
            targetElement.innerHTML = `<div class="max-h-64 overflow-y-auto">${itemsHTML}</div>`;
        }

        function createFormAccordionContent(sectionKey, targetElement) {
            let contentHTML = '<div class="space-y-4">';
            const section = appData.formSections[sectionKey];

            for (const fieldKey in section.fields) {
                const field = section.fields[fieldKey];
                contentHTML += `<div><label for="${fieldKey}" class="block text-xs font-medium text-stone-400 mb-1">${field.label}</label>`;

                if (field.type === 'select') {
                    contentHTML += `<select id="${fieldKey}" name="${fieldKey}"></select>`;
                } else if (field.type === 'text') {
                    contentHTML += `<input type="text" id="${fieldKey}" name="${fieldKey}" placeholder="${field.placeholder || ''}">`;
                } else if (field.type === 'text-ia') {
                    contentHTML += `<div class="flex items-center">
                                      <input type="text" id="${fieldKey}" name="${fieldKey}">
                                      <button type="button" id="${field.buttonId}" title="Gerar com IA" class="ai-suggestion-btn">✨<div id="${field.loaderId}" class="loader small-loader ml-1 hidden"></div></button>
                                  </div>`;
                } else if (field.type === 'textarea') {
                    contentHTML += `<textarea id="${fieldKey}" name="${fieldKey}" rows="${field.rows || 3}" placeholder="${field.placeholder || ''}"></textarea>`;
                } else if (field.type === 'textarea-ia') {
                    contentHTML += `<textarea id="${fieldKey}" name="${fieldKey}" rows="${field.rows || 5}" placeholder="${field.placeholder || ''}"></textarea>
                                  <button type="button" id="${field.buttonId}" class="mt-1 w-full text-xs bg-lime-600 hover:bg-lime-700 text-white font-semibold py-1 px-2 rounded-lg flex items-center justify-center">Gerar História <div id="${field.loaderId}" class="loader small-loader ml-2 hidden"></div></button>`;
                }
                contentHTML += `</div>`;
            }
            contentHTML += '</div>';
            targetElement.innerHTML = contentHTML;
        }

        function populateSelect(selectId, options, hasOptgroups = false) {
            const selectElement = document.getElementById(selectId);
            if (!selectElement) return;
            selectElement.innerHTML = ''; 
            if (hasOptgroups) {
                for (const groupLabel in options) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = groupLabel;
                    options[groupLabel].forEach(optionValue => {
                        const option = document.createElement('option');
                        option.value = `${groupLabel}|${optionValue}`;
                        option.textContent = optionValue;
                        optgroup.appendChild(option);
                    });
                    selectElement.appendChild(optgroup);
                }
            } else {
                options.forEach(optionValue => {
                    const option = document.createElement('option');
                    option.value = optionValue;
                    option.textContent = optionValue;
                    selectElement.appendChild(option);
                });
            }
        }
        
        function populateAllCharacterFields() {
             Object.values(appData.formSections).forEach(section => {
                for (const fieldKey in section.fields) {
                    const field = section.fields[fieldKey];
                    if (field.type === 'select') {
                        populateSelect(fieldKey, field.options, !!field.hasOptgroups);
                    }
                }
             });
             
             const presetSelect = document.getElementById('presets');
             if (presetSelect) {
                 presetSelect.innerHTML = '<option value="">Selecione um preset...</option>';
                 Object.keys(presets).forEach(key => {
                     const option = document.createElement('option');
                     option.value = key;
                     option.textContent = presets[key].nomePersonagem;
                     presetSelect.appendChild(option);
                 });
             }
        }
        
        function toggleAccordion(button, content) {
            if (!content) return;
            
            if (openAccordion && openAccordion !== content) {
                openAccordion.classList.remove('open');
                const oldButton = document.querySelector(`.category-button[data-key="${openAccordion.id.replace('accordion-','')}"`);
                if(oldButton) oldButton.parentElement.classList.remove('active');
            }
            
            content.classList.toggle('open');
            button.parentElement.classList.toggle('active');

            openAccordion = content.classList.contains('open') ? content : null;
        }

        function toggleMainSection(header) {
             const content = header.nextElementSibling;
             if (!content) return;

             if(openMainSection && openMainSection !== content) {
                 openMainSection.classList.remove('open');
                 openMainSection.previousElementSibling.classList.remove('active');
             }

             content.classList.toggle('open');
             header.classList.toggle('active');

             openMainSection = content.classList.contains('open') ? content : null;
        }
        
        function renderAllCategories() {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';
            
            const allCategories = [
                ...Object.entries(appData.formSections).map(([key, value]) => ({
                    id: key, title: value.title, icon: value.icon, type: 'form'
                })),
                ...Object.entries(appData.styleLists).map(([key, value]) => ({
                    id: key, title: value.title, icon: value.icon, type: 'style'
                }))
            ];

            allCategories.forEach(cat => {
                container.innerHTML += createAccordionButton(cat.id, cat.title, cat.icon);
            });

            allCategories.forEach(cat => {
                const accordionContent = document.getElementById(`accordion-${cat.id}`);
                if (cat.type === 'style') {
                    createStyleAccordionContent(cat.id, accordionContent);
                } else {
                    createFormAccordionContent(cat.id, accordionContent);
                }
            });

            populateAllCharacterFields();
        }

        // --- FEATURE FUNCTIONS (IA, File Handling, etc.) ---

        function setupImageAnalysis() {
            const imageUpload = document.getElementById('imageUpload');
            const imagePreview = document.getElementById('imagePreview');
            const imagePreviewPlaceholder = document.getElementById('imagePreviewPlaceholder');
            const analyzeImageBtn = document.getElementById('analyzeImageBtn');
            const analyzeLoader = document.getElementById('analyzeLoader');

            imageUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) {
                    base64ImageData = null;
                    return;
                }
                if (file.size > 4 * 1024 * 1024) { 
                    showToast('Erro: Imagem excede 4MB.', 'error');
                    imageUpload.value = ''; 
                    return;
                }
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    imagePreviewPlaceholder.classList.add('hidden');
                    base64ImageData = e.target.result.split(',')[1]; 
                }
                reader.readAsDataURL(file);
            });

            analyzeImageBtn.addEventListener('click', async () => {
                if (!base64ImageData) {
                    showToast('Por favor, carregue uma imagem primeiro.', 'warning');
                    return;
                }
                
                const promptParaGemini = `Analise esta imagem de um personagem. Extraia as informações e formate a resposta com um marcador por linha (ex: "Cor da Pele: [valor]"). Campos para extrair: Gênero Aparente, Tipo de Corpo, Cor dos Olhos, Cor do Cabelo, Penteado, Cor da Pele, Vestimenta Principal, Armadura, Acessórios Visíveis, Arma Principal, Pose, Expressão Facial, Estilo Artístico da Imagem, Cenário Imediato, Descrição Geral Detalhada. Se algo não for visível, omita o marcador.`;
                const payload = {
                    contents: [{ role: "user", parts: [{ text: promptParaGemini }, { inlineData: { mimeType: imageUpload.files[0].type, data: base64ImageData } }] }]
                };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent`;
                
                const result = await callApi(apiUrl, payload, analyzeLoader, analyzeImageBtn);

                if (result && result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    parseAndFillForm(result.candidates[0].content.parts[0].text);
                    showToast('Análise da imagem concluída!', 'success');
                } else if(result) {
                     showToast('A IA respondeu, mas o formato é inesperado.', 'warning');
                }
            });
        }
        
        function setupTextAnalysis() {
            const fileInput = document.getElementById('analyzeTxtFileInput');
            const analyzeBtn = document.getElementById('analyzeTxtAndFillBtn');
            const loader = document.getElementById('analyzeTxtLoader');

            analyzeBtn.addEventListener('click', () => fileInput.click());

            fileInput.addEventListener('change', (event) => {
                 const file = event.target.files[0];
                 if (!file) return;

                 const reader = new FileReader();
                 reader.onload = async (e) => {
                    const fileContent = e.target.result;
                    if (!fileContent.trim()) {
                        showToast('O arquivo de texto está vazio.', 'warning');
                        return;
                    }
                    const promptParaGemini = `Analise a seguinte descrição de personagem e extraia as informações para os campos do formulário. Formate a resposta com um marcador por linha (ex: "Nome: [valor]"). Campos: Nome, Gênero, Raça/Espécie, Arquétipo, Tipo de Corpo, Cor da Pele, Cor do Cabelo, Penteado, Cor dos Olhos, Vestimenta Principal, Armadura, Arma, Ação/Pose, Expressão Facial, Cenário, Tema, Características Essenciais. Texto: \n---\n${fileContent}`;
                    const payload = { contents: [{ role: "user", parts: [{ text: promptParaGemini }] }] };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent`;
                    
                    const result = await callApi(apiUrl, payload, loader, analyzeBtn);
                    if (result && result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        parseAndFillForm(result.candidates[0].content.parts[0].text);
                        showToast('Formulário preenchido com base no texto!', 'success');
                    } else if (result) {
                        showToast('A IA respondeu, mas o formato é inesperado.', 'warning');
                    }
                 };
                 reader.readAsText(file);
                 event.target.value = ''; 
            });
        }

        function parseAndFillForm(apiResponseText) {
            const lines = apiResponseText.split('\n');
            const data = {};
            lines.forEach(line => {
                const parts = line.split(': ');
                if (parts.length > 1) {
                    data[parts[0].trim().toLowerCase()] = parts.slice(1).join(': ').trim();
                }
            });

            const fieldMappings = {
                'nome': 'nomePersonagem', 'gênero': 'genero', 'gênero aparente': 'genero', 'raça/espécie': 'racaEspecie',
                'arquétipo': 'arquetipo', 'tipo de corpo': 'tipoCorpo', 'cor da pele': 'corPele', 'cor do cabelo': 'corCabelo',
                'penteado': 'penteado', 'cor dos olhos': 'corOlhos', 'vestimenta principal': 'vestimentaPrincipal',
                'armadura': 'armadura', 'arma': 'armas', 'arma principal': 'armas', 'ação/pose': 'acaoPose', 'pose': 'acaoPose', 'expressão facial': 'expressaoFacial',
                'cenário': 'cenarioDetalhado', 'cenário imediato': 'cenarioDetalhado', 'tema': 'temaGeral', 'descrição geral detalhada': 'caracteristicasFisicas',
                'características essenciais': 'caracteristicasFisicas', 'estilo artístico da imagem': 'style'
            };

            for (const key in data) {
                const formFieldId = fieldMappings[key];
                if (formFieldId) {
                    if (formFieldId === 'style') {
                        const styles = data[key].split(',').map(s => s.trim());
                        styles.forEach(style => {
                            const matchingTerm = Array.from(document.querySelectorAll('.style-term-item')).find(el => el.dataset.term.toLowerCase().includes(style.toLowerCase()));
                            if(matchingTerm) styleSelectedTerms.add(matchingTerm.dataset.term);
                        });
                    } else {
                        const element = document.getElementById(formFieldId);
                        if (element) {
                            if (element.tagName === 'SELECT') {
                                const valueToFind = data[key];
                                for (let option of element.options) {
                                    if (option.textContent.toLowerCase().includes(valueToFind.toLowerCase())) {
                                        element.value = option.value;
                                        break;
                                    }
                                }
                            } else {
                                element.value = data[key];
                            }
                        }
                    }
                }
            }
            document.querySelectorAll('.style-term-item').forEach(el => {
                 el.classList.toggle('selected-item', styleSelectedTerms.has(el.dataset.term));
            });
        }

        async function generateCharacterName() {
            const raca = document.getElementById('racaEspecie').selectedOptions[0]?.textContent || "personagem";
            const genero = document.getElementById('genero').value !== "Não especificado" ? document.getElementById('genero').value : "";
            let promptText = `Sugira um nome criativo e único para um(a) personagem ${raca} ${genero}. Forneça apenas o nome, sem frases adicionais.`;
            const payload = { contents: [{ role: "user", parts: [{ text: promptText }] }] };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent`;
            
            const result = await callApi(apiUrl, payload, document.getElementById('nameLoader'), document.getElementById('generateNameBtn'));

            if (result && result.candidates?.[0]?.content?.parts?.[0]?.text) {
                document.getElementById('nomePersonagem').value = result.candidates[0].content.parts[0].text.trim().replace(/["*.]/g, '');
                showToast('Nome gerado!', 'success');
            }
        }
        
        async function generateBackstory() {
             const context = getFormDataAsObject();
             let promptText = `Crie uma breve história de fundo (2-3 parágrafos curtos) para um personagem.
                - Nome: ${context.nomePersonagem || 'um personagem sem nome'}
                - Raça e Arquétipo: um(a) ${context.racaEspecie || 'ser'} do tipo ${context.arquetipo || 'desconhecido'}.
                - Detalhes: ${context.caracteristicasFisicas || 'aparência não descrita'}.
                - Tema geral da história: ${context.temaGeral || 'aventura'}.
                - Cenário: A história se passa em um(a) ${context.cenarioDetalhado || 'local não especificado'}.
                Escreva uma história coesa e interessante com base nessas informações.`;

             const payload = { contents: [{ role: "user", parts: [{ text: promptText }] }] };
             const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent`;
             
             const result = await callApi(apiUrl, payload, document.getElementById('backstoryLoader'), document.getElementById('generateBackstoryBtn'));

             if(result && result.candidates?.[0]?.content?.parts?.[0]?.text) {
                 document.getElementById('historiaFundoGerada').value = result.candidates[0].content.parts[0].text;
                 showToast('História gerada!', 'success');
             }
        }

        async function generateImagePreview() {
            let promptText = document.getElementById('generatedPrompt').value;
            if (!promptText) {
                showToast('Gere um prompt primeiro.', 'warning');
                return;
            }
            
            const qualityTerms = "obra-prima, alta qualidade, fotorrealista, 8k, uhd";
            if (!promptText.toLowerCase().includes('obra-prima') && !promptText.toLowerCase().includes('alta qualidade')) {
                promptText += `, ${qualityTerms}`;
            }

            const imageGenLoader = document.getElementById('imageGenLoader');
            const btn = document.getElementById('generateImagePreviewBtn');
            const imagePreviewEl = document.getElementById('generatedImagePreview');
            const imagePlaceholderEl = document.getElementById('generatedImagePlaceholder');

            imagePreviewEl.classList.add('hidden');
            imagePlaceholderEl.textContent = "Gerando imagem...";
            imagePlaceholderEl.classList.remove('hidden');

            const payload = { instances: [{ prompt: promptText }], parameters: { "sampleCount": 1 } };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict`;
            
            const result = await callApi(apiUrl, payload, imageGenLoader, btn);

            if (result && result.predictions?.[0]?.bytesBase64Encoded) {
                const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                imagePreviewEl.src = imageUrl;
                imagePreviewEl.classList.remove('hidden');
                imagePlaceholderEl.classList.add('hidden');
                showToast('Imagem gerada com sucesso!', 'success');
            } else {
                imagePlaceholderEl.textContent = "Falha ao gerar imagem.";
                 if (result) {
                    showToast('A resposta da IA de imagem estava vazia.', 'warning');
                 }
            }
        }

        function getFormDataAsObject() {
            const data = {};
            const form = document.getElementById('characterForm');
            new FormData(form).forEach((value, key) => {
                if (value && value !== "Não especificado" && !value.endsWith("|Não especificado")) {
                   data[key] = value.includes('|') ? value.split('|')[1] : value;
                }
            });
            data.styleSelectedTerms = Array.from(styleSelectedTerms);
            return data;
        }

        function fillFormWithData(data) {
            clearAllFields(false);
            const form = document.getElementById('characterForm');
            for(const key in data){
                if (key === 'styleSelectedTerms') {
                    const terms = data[key].map(item => {
                        const match = item.match(/(.*?)\s*\(/);
                        return match ? match[1].trim() : item;
                    });
                    styleSelectedTerms = new Set(terms);
                } else if(form.elements[key]){
                     const element = form.elements[key];
                     if(element.tagName === 'SELECT'){
                         let found = false;
                         for(let opt of element.options){
                             const optText = opt.textContent;
                             const optVal = opt.value.includes('|') ? opt.value.split('|')[1] : opt.value;
                             if(optText === data[key] || optVal === data[key]){
                                element.value = opt.value;
                                found = true;
                                break;
                             }
                         }
                     } else {
                         element.value = data[key];
                     }
                }
            }
            document.querySelectorAll('.style-term-item').forEach(el => {
                el.classList.toggle('selected-item', styleSelectedTerms.has(el.dataset.term));
            });
        }

        function saveCharacterAsTxt() {
            const characterData = getFormDataAsObject();
            const characterName = characterData.nomePersonagem || 'personagem_chargen_pro';
            const filename = `${characterName.replace(/[\s/\\?%*:|"<>]/g, '_').toLowerCase()}.txt`;
            const dataStr = JSON.stringify(characterData, null, 2); 
            
            const blob = new Blob([dataStr], {type: "text/plain;charset=utf-8"});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showToast(`Personagem salvo como ${filename}!`, 'success');
        }

        function loadCharacterFromTxt(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const characterData = JSON.parse(e.target.result); 
                    fillFormWithData(characterData);
                    showToast(`Personagem carregado!`, 'success');
                } catch (error) {
                    showToast('Erro ao carregar: Arquivo inválido ou malformado.', 'error');
                } finally {
                     event.target.value = ''; 
                }
            };
            reader.readAsText(file);
        }

        function applySelectedPreset() {
            const presetSelect = document.getElementById('presets');
            const presetKey = presetSelect.value;
            if (presetKey && presets[presetKey]) {
                const presetData = presets[presetKey];
                fillFormWithData(presetData);
                showToast(`Preset "${presetData.nomePersonagem}" aplicado!`, 'success');
            }
        }

        function clearAllFields(notify = true) {
            document.getElementById('characterForm').reset();
            styleSelectedTerms.clear();
            document.querySelectorAll('.selected-item').forEach(el => el.classList.remove('selected-item'));
            document.getElementById('generatedPrompt').value = '';
            
            const imagePreview = document.getElementById('imagePreview');
            const imagePreviewPlaceholder = document.getElementById('imagePreviewPlaceholder');
            imagePreview.classList.add('hidden');
            imagePreview.src = "#";
            imagePreviewPlaceholder.classList.remove('hidden');
            document.getElementById('imageUpload').value = ''; 
            base64ImageData = null;

            const generatedImagePreviewEl = document.getElementById('generatedImagePreview');
            const generatedImagePlaceholderEl = document.getElementById('generatedImagePlaceholder');
            generatedImagePreviewEl.classList.add('hidden');
            generatedImagePreviewEl.src = "#";
            generatedImagePlaceholderEl.textContent = "A imagem gerada aparecerá aqui...";
            generatedImagePlaceholderEl.classList.remove('hidden');
            
            if (notify) showToast('Todos os campos foram limpos!', 'info');
        }

        function randomizeAllFields() {
            clearAllFields(false);
            const presetKeys = Object.keys(presets);
            const randomPresetKey = presetKeys[Math.floor(Math.random() * presetKeys.length)];
            
            if (randomPresetKey) {
                const presetData = presets[randomPresetKey];
                fillFormWithData(presetData);
                showToast('Preset aleatório aplicado!', 'info');
            }
        }
        
        function generatePrompt(type) {
            const formData = getFormDataAsObject();
            let promptParts = [];

            const addPart = (part) => {
                if (part && part.trim() !== '') {
                    promptParts.push(part.trim());
                }
            };
            
            let subjectParts = [];
            subjectParts.push("Retrato de corpo inteiro");
            subjectParts.push(`de ${formData.nomePersonagem || 'um personagem'}`);
            if (formData.racaEspecie) subjectParts.push(`, um(a) ${formData.racaEspecie}`);
            if (formData.arquetipo) subjectParts.push(formData.arquetipo);
            if (formData.genero && formData.genero !== 'Não especificado') subjectParts.push(`do gênero ${formData.genero}`);
            addPart(subjectParts.join(' '));

            let appearanceParts = [];
            if(formData.tipoCorpo) appearanceParts.push(`com corpo ${formData.tipoCorpo}`);
            if(formData.corPele) appearanceParts.push(`pele ${formData.corPele}`);
            if(formData.penteado) appearanceParts.push(`penteado ${formData.penteado}`);
            if(formData.corCabelo) appearanceParts.push(`cabelo ${formData.corCabelo}`);
            if(formData.corOlhos) appearanceParts.push(`olhos da cor ${formData.corOlhos}`);
            if(formData.caracteristicasFisicas) appearanceParts.push(formData.caracteristicasFisicas);
            addPart(appearanceParts.join(", "));

            let gearParts = [];
            if(formData.vestimentaPrincipal) gearParts.push(`vestindo ${formData.vestimentaPrincipal}`);
            if(formData.armadura) gearParts.push(`com ${formData.armadura}`);
            if(formData.armas) gearParts.push(`empunhando ${formData.armas}`);
            addPart(gearParts.join(", "));

            if(formData.acaoPose) addPart(`em pose de ${formData.acaoPose}`);
            if(formData.expressaoFacial) addPart(`com expressão ${formData.expressaoFacial}`);
            if(formData.cenarioDetalhado) addPart(`no cenário de ${formData.cenarioDetalhado}`);
            if(formData.temaGeral) addPart(`em um tema de ${formData.temaGeral}`);
            
            if (formData.styleSelectedTerms.length > 0) {
                addPart(`no estilo de ${formData.styleSelectedTerms.join(', ')}`);
            }
            
            const rascunho = document.getElementById('rascunhoTextarea').value.trim();
            addPart(rascunho);

            const separator = (type === 'detalhado') ? ". " : ", ";
            let finalPrompt = promptParts.filter(p => p).join(separator);
            
            const promptNegativo = formData.promptNegativo || "deformado, texto, watermark, feio, duplicado, má qualidade, baixa resolução";
            finalPrompt += ` --no ${promptNegativo}`;
            
            finalPrompt = finalPrompt.replace(/[,.]\s*--no/, ' --no');

            document.getElementById('generatedPrompt').value = finalPrompt;
            if (promptParts.length > 0) {
                showToast(`Prompt ${type} gerado!`, 'success');
            } else {
                showToast('Nenhuma informação selecionada.', 'warning');
            }
        }

        // --- INITIALIZATION ---
        function initializeUI() {
            renderAllCategories();

            document.getElementById('categories-container').addEventListener('click', (e) => {
                const button = e.target.closest('.category-button');
                if (button) {
                    e.preventDefault();
                    toggleAccordion(button, document.getElementById(`accordion-${button.dataset.key}`));
                    if (button.dataset.key === 'aparencia') {
                         if(document.getElementById('generateNameBtn')) document.getElementById('generateNameBtn').addEventListener('click', generateCharacterName);
                    } else if (button.dataset.key === 'desenvolvimento') {
                         if(document.getElementById('generateBackstoryBtn')) document.getElementById('generateBackstoryBtn').addEventListener('click', generateBackstory);
                    }
                }
                if (e.target.matches('.style-term-item')) {
                    e.preventDefault();
                    const term = e.target.dataset.term;
                    e.target.classList.toggle('selected-item');
                    if (styleSelectedTerms.has(term)) styleSelectedTerms.delete(term);
                    else styleSelectedTerms.add(term);
                }
            });

            document.querySelectorAll('.main-section-header').forEach(header => {
                header.addEventListener('click', () => toggleMainSection(header));
            });
            
            const promptHeader = Array.from(document.querySelectorAll('.main-section-header')).find(h => h.textContent.includes('Seu Prompt Final'));
            if(promptHeader) {
                setTimeout(() => toggleMainSection(promptHeader), 100);
            }

            document.getElementById('generateCompactPromptBtn').addEventListener('click', () => generatePrompt('compacto'));
            document.getElementById('generateDetailedPromptBtn').addEventListener('click', () => generatePrompt('detalhado'));
            document.getElementById('copyPromptBtn').addEventListener('click', () => copyUsingExecCommand(document.getElementById('generatedPrompt').value));
            document.getElementById('randomizeAllBtn').addEventListener('click', randomizeAllFields);
            document.getElementById('clearAllBtn').addEventListener('click', () => clearAllFields(true));

            const hamburgerBtn = document.getElementById('hamburger-btn');
            const sideMenu = document.getElementById('sidebar');
            const closeMenuBtn = document.getElementById('close-sidebar-btn');
            hamburgerBtn.addEventListener('click', () => sideMenu.classList.remove('-translate-x-full'));
            closeMenuBtn.addEventListener('click', () => sideMenu.classList.add('-translate-x-full'));

            setupImageAnalysis();
            setupTextAnalysis();
            document.getElementById('generateImagePreviewBtn').addEventListener('click', generateImagePreview);
            
            document.getElementById('saveCharacterTxtBtn').addEventListener('click', saveCharacterAsTxt);
            document.getElementById('loadCharacterBtn').addEventListener('click', () => document.getElementById('loadCharacterFileInput').click());
            document.getElementById('loadCharacterFileInput').addEventListener('change', loadCharacterFromTxt);
            document.getElementById('applyPresetBtn').addEventListener('click', applySelectedPreset);

            const openRascunhoBtn = document.getElementById('openRascunhoBtn');
            const closeRascunhoBtn = document.getElementById('closeRascunhoBtn');
            const rascunhoSidebar = document.getElementById('rascunhoSidebar');
            openRascunhoBtn.addEventListener('click', () => { rascunhoSidebar.classList.remove('translate-x-full'); openRascunhoBtn.classList.add('hidden'); });
            closeRascunhoBtn.addEventListener('click', () => { rascunhoSidebar.classList.add('translate-x-full'); openRascunhoBtn.classList.remove('hidden'); });
            document.getElementById('addRascunhoToPromptBtn').addEventListener('click', () => {
                const promptTextarea = document.getElementById('generatedPrompt');
                const rascunhoText = document.getElementById('rascunhoTextarea').value.trim();
                if(rascunhoText){
                    promptTextarea.value += (promptTextarea.value ? ', ' : '') + rascunhoText;
                    showToast('Rascunho adicionado!', 'success');
                }
            });
            document.getElementById('clearRascunhoBtn').addEventListener('click', () => {
                document.getElementById('rascunhoTextarea').value = '';
                showToast('Rascunho limpo.', 'info');
            });
        }
        
        initializeUI();
    });
    </script>
</body>
</html>
